include "kadeploy3"
include "snoozeclient"

$groupManagerHeartbeatPort = 1000+$idfromhost

class { 
  'snoozenode':
    type                                 => "<%= @nodeType %>",
    controlDataPort                      => 5000,
    listenAddress                        => $ipaddress,
    multicastAddress                     => "225.14.15.16",
    groupManagerHeartbeatPort            => $groupManagerHeartbeatPort,
    zookeeperHosts                       => ["<%= @zookeeperHosts %>"],
    virtualMachineSubnet                 => <%= @virtualMachineSubnets %>,
    externalNotificationHost             => "<%= @externalNotificationHost %>",
    databaseType                         => "cassandra",
    databaseCassandraHosts               => <%= @databaseCassandraHosts %>,
    migrationMethod                      => "forceunsafe",
    migrationTimeout                     => 60,
    groupManagerSchedulerPluginsDirectory=> "/usr/share/snoozenode/plugins/groupManagerScheduler",
    placementPolicy                      => "RoundRobin",
    imageRepositorySource                => "/var/lib/libvirt/snoozeimages",
    imageRepositoryDestination           => "/tmp/images",
    reconfigurationEnabled               => false,
    reconfigurationPolicy                => "Sercon",
    reconfigurationInterval              => "0 0/1 *  * * ?",
    energyManagementEnabled              => false,
    energyManagementIdleTime             => 30,
    energyManagementPowerSavingAction    => "suspendToRam",
    energyManagementThresholdsWakeupTime => 60 

}


<% if @nodeType == "bootstrap" %>
  include "snoozeimages"
  include "snoozeec2"
<%=
  "
  class { 
     'zookeeper::zookeeperd': 
      zookeeperHosts            => [\"" + @zookeeperdHosts + "\"],
  }
"
%>

<%  end %>

